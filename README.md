 <p align="center">
  <img src="https://img.shields.io/badge/Jenkins-CI%2FCD-red?logo=jenkins&logoColor=white" alt="Jenkins Badge"/>
  <img src="https://img.shields.io/badge/Docker-Container-blue?logo=docker&logoColor=white" alt="Docker Badge"/>
  <img src="https://img.shields.io/badge/Kubernetes-Orchestration-326ce5?logo=kubernetes&logoColor=white" alt="Kubernetes Badge"/>
  <img src="https://img.shields.io/badge/Helm-K8s%20Package%20Manager-0f1689?logo=helm&logoColor=white" alt="Helm Badge"/>
  <img src="https://img.shields.io/badge/Minikube-Local%20Cluster-yellow?logo=minikube&logoColor=black" alt="Minikube Badge"/>
<a href="https://hub.docker.com/r/aithrien/my-microservice" target="_blank">
    <img src="https://img.shields.io/badge/DockerHub-View%20Image-blue?logo=docker&logoColor=white" alt="DockerHub Badge"/>
  </a>
</p>

## 🧪 Release Engineering Lab: From CI to Kubernetes

This project is a complete, hands-on Release Engineering lab designed to walk through the entire journey of building, testing, containerizing, and deploying a Node.js microservice using modern DevOps tooling.


---

## 🗂️ Project Structure

```bash
my-microservice/
├── Dockerfile
├── index.js
├── package.json
├── public/
├── my-microservice-chart/      # Helm chart (generated by helm create)
└── Jenkinsfile                 # CI pipeline definition
```

---

## 🚀 Prerequisites

- Ubuntu 24.04
- Docker (installed and user in `docker` group)
- Node.js (for local testing)
- Git
- Jenkins (installed and running at http://localhost:8080)
- Minikube (with Docker driver)
- Helm (v3.x)

---

## ✅ Step-by-Step Guide

### 🧱 Part 1: Create the Node.js Microservice

1. Clone a basic example:
```bash
git clone https://github.com/heroku/node-js-sample.git my-microservice
cd my-microservice
```

2. Edit `index.js`:
```js
app.set('port', process.env.PORT || 3000);
app.listen(app.get('port'), '0.0.0.0', function () {
  console.log("App running on port " + app.get('port'));
});
```

3. Add `Dockerfile`:
```Dockerfile
FROM node:18
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 3000
CMD ["npm", "start"]
```

---

### ⚙️ Part 2: Set Up Jenkins CI

1. Install Jenkins and required plugins:
   - Pipeline
   - Docker Pipeline
   - Git

2. Create a Jenkins Pipeline Job: `my-microservice-pipeline`

3. Use this `Jenkinsfile`:
```groovy
pipeline {
  agent any

  environment {
    IMAGE_NAME = "my-microservice:latest"
  }

  stages {
    stage('Checkout') {
      steps {
        git branch: 'main', url: 'https://github.com/<your-username>/my-microservice.git'
      }
    }

    stage('Install dependencies') {
      steps {
        sh 'npm install'
      }
    }

    stage('Run tests') {
      steps {
        sh 'npm test || true'
      }
    }

    stage('Build Docker Image') {
      steps {
        sh 'docker build -t $IMAGE_NAME .'
      }
    }
  }

  post {
    always {
      sh 'docker stop microservice || true'
    }
  }
}
```

---

### 🔁 Part 3A: GitHub Webhooks

1. Start Jenkins and expose it via ngrok:
```bash
ngrok http 8080
```

2. Copy the forwarding URL and configure GitHub webhook:
   - Payload URL: `https://<ngrok-subdomain>.ngrok.io/github-webhook/`
   - Event: `Push`

3. Enable webhook in Jenkins Job:
   - `GitHub hook trigger for GITScm polling`

---

### 📦 Part 3B: Local Docker Registry

1. Start the registry:
```bash
docker run -d -p 5000:5000 --restart=always --name registry registry:2
```

2. Tag and push your image:
```bash
docker tag my-microservice localhost:5000/my-microservice:latest
docker push localhost:5000/my-microservice:latest
```

3. Confirm:
```bash
curl http://localhost:5000/v2/_catalog
```

4. Run it locally:
```bash
docker run -d -p 3001:3000 -e PORT=3000 localhost:5000/my-microservice:latest
```

---

### ☸️ Part 3C: Kubernetes + Helm

1. Start Minikube:
```bash
minikube start --driver=docker
```

2. Switch Docker context:
```bash
eval $(minikube docker-env)
```

3. Build inside Minikube:
```bash
docker build -t my-microservice:latest .
```

4. Create a Helm chart:
```bash
helm create my-microservice-chart
```

5. In `values.yaml`, update:
```yaml
image:
  repository: my-microservice
  tag: latest
  pullPolicy: IfNotPresent

service:
  type: NodePort
  port: 3000
```

6. In `deployment.yaml`, under `containers:`:
```yaml
env:
  - name: PORT
    value: "3000"
```

7. Deploy:
```bash
helm upgrade --install my-microservice ./my-microservice-chart
```

8. Access the app:
```bash
minikube service my-microservice-my-microservice-chart
```



---

## 🐳 DockerHub Usage

This image is built and published via CI to DockerHub.

**Pull and run it locally:**
```bash
docker pull aithrien/my-microservice:latest
docker run -p 3000:3000 aithrien/my-microservice
```

See the published image here:  
https://hub.docker.com/r/aithrien/my-microservice

---

## 📈 Next Steps / Portfolio Extensions

### 🧪 Test Reports and SonarQube
- Integrate test reports using `junit` plugin
- Add SonarQube scanner to pipeline for static analysis

### ☁️ Push to Remote Registries / Cloud
- Use DockerHub or GitHub Container Registry
- Deploy to GKE / EKS / AKS instead of local Minikube

### 📊 Monitoring & Probes
- Add `readinessProbe` and `livenessProbe` to Helm chart
- Use Prometheus + Grafana for container metrics

### 🛡️ Security & Hardening
- Scan images with Trivy
- Add role-based access and secrets via K8s

---

📄 **Project Summary:**  
See [RELEASE_PIPELINE_PORTFOLIO.md](./RELEASE_PIPELINE_PORTFOLIO.md) for a full overview of this CI/CD pipeline, rollback strategy, and future roadmap.
